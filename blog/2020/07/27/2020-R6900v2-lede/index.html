<!DOCTYPE html>
<html lang="en-us">
  <head>
  <title>R6900v2安装LEDE.org - org-page</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="author" content="shirui" />
    <meta name="description" content="讲解R6900v2安装配置LEDE" />
    <meta name="keywords" content="OpenWrt, LEDE, router" />
  <link rel="stylesheet" media="screen" href="/media/css/font.css" rel="stylesheet" type="text/css"/>
  <link rel="stylesheet" href="/media/css/main.css" type="text/css">
  <link rel="stylesheet" href="/media/css/prettify.css" type="text/css">
</head>

  <body class="container">
    <div>
  <header class="masthead">
    <h1 class="masthead-title"><a href="/">org-page</a></h1>
    <p>static site generator</p>
    <nav class="site-nav">
      <div class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z" fill="#ffff00"/>
          <path d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z" fill="#ffff00"/>
          <path d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z" fill="#ffff00"/>
        </svg>
      </div>
      <ul class="trigger">
          <li><a href="/blog/">Blog</a></li>
        <li><a href="/tags/">Tags</a></li>
        <li><a href="/about/">About</a></li>
        <li><a href="https://github.com/lampze/">GitHub</a></li>
        <li><a href="/rss.xml">RSS</a></li>
      </ul>
    </nav>
    <form method="get" id="searchform" action="//www.google.com/search">
      <input type="text" class="field" name="q" id="s" placeholder="Search">
      <input type="hidden" name="as_sitesearch" value="lampze.github.io">
    </form>
  </header>
</div>

    <div>
<div class="post">
<h1 class="title">R6900v2安装LEDE.org</h1>

<div id="outline-container-orgbcb4abb" class="outline-2">
<h2 id="orgbcb4abb">前言</h2>
<div class="outline-text-2" id="text-orgbcb4abb">
<p>
首先我先劝退一波想买这个路由器的同学，以下是理由。
</p>

<ol class="org-ol">
<li>支持的固件少并且不更新，不接受的同学只能自己编译固件</li>
<li>编译时有许多的坑，一个不小心路由器就变砖了</li>
<li>网件原厂的固件虽然稳定，但界面不好看还慢，功能也少</li>
</ol>

<p>
如果你能接受或者已经买了就继续往下看吧。
</p>

<p>
编译的固件选择了 <code>LEDE</code> ，因为作者是国人，在国内很多需求是相同的。
</p>

<p>
有些自己编译过的同学可能会发现，配置的时候找不到这个路由器，根据这个<a href="https://github.com/openwrt/openwrt/pull/2614#issuecomment-569452109">PR</a>里说的情况， <code>R6700v2</code> 、 <code>R6800</code> 、 <code>R6900v2</code> 、 <code>R7450</code> 这几个路由器的核心硬件是相同的，甚至它们的官方固件都有相同的 <code>md5</code> ，理论上来说在配置时选择这个几个路由器都行，我测试过确实是可行的，目前我选择了 <code>R6700v2</code> 。
</p>

<p>
最后编译时要注意刷机包的大小，大于30的话，刷完机路由器是开不了的。
</p>
</div>
</div>

<div id="outline-container-orgafc6978" class="outline-2">
<h2 id="orgafc6978">准备</h2>
<div class="outline-text-2" id="text-orgafc6978">
<p>
请自行准备好以下的东西再进行刷机
</p>

<ol class="org-ol">
<li>可用的 <code>Linux</code> 系统</li>
<li>根据<a href="https://github.com/coolsnowwolf/lede">官方文档</a>准备好环境，没有科学上网很慢的</li>
<li><code>nmrpflash</code> 工具，用来救砖</li>
</ol>

<p>
请完全准备好后再进行刷机的尝试，如果路由器变砖了就很麻烦了。
</p>
</div>
</div>

<div id="outline-container-orge53a5b5" class="outline-2">
<h2 id="orge53a5b5">制作固件</h2>
<div class="outline-text-2" id="text-orge53a5b5">
</div>
<div id="outline-container-orge7c1285" class="outline-3">
<h3 id="orge7c1285">准备</h3>
<div class="outline-text-3" id="text-orge7c1285">
<p>
进入 <code>LEDE</code> 目录，编辑 <code>feeds.conf.default</code> 文件，取消 <code>helloworld</code> 所在行的注释，这样就能选择 <code>ssr</code> 了，以下是示例。
</p>

<pre class="example" id="org06b4045">
src-git packages https://github.com/coolsnowwolf/packages
src-git luci https://github.com/coolsnowwolf/luci
src-git routing https://git.openwrt.org/feed/routing.git
src-git telephony https://git.openwrt.org/feed/telephony.git
src-git freifunk https://github.com/freifunk/openwrt-packages.git
#src-git video https://github.com/openwrt/video.git
#src-git targets https://github.com/openwrt/targets.git
#src-git management https://github.com/openwrt-management/packages.git
#src-git oldpackages http://git.openwrt.org/packages.git
#src-link custom /usr/src/openwrt/custom-feed
src-git helloworld https://github.com/fw876/helloworld
</pre>

<p>
然后更新安装 <code>feed</code> ， <code>feed</code> 存放着各种软件源码。
</p>
<div class="org-src-container">
<pre class="src src-shell">./scripts/feeds update -a
./scripts/feeds install -a
</pre>
</div>
</div>
</div>

<div id="outline-container-org042c258" class="outline-3">
<h3 id="org042c258">make menuconfig</h3>
<div class="outline-text-3" id="text-org042c258">
<p>
然后就是配置 <code>LEDE</code> 了， 运行命令 <code>make menuconfig</code> 。我来展示一些必要选项。
</p>

<pre class="example" id="orgea3870c">
Target System (MediaTek Ralink MIPS)  ---&gt;
Subtarget (MT7621 based boards)  ---&gt;
Target Profile (NETGEAR R7200 v1 (NETGEAR R6700 v2))  ---&gt;
</pre>

<p>
使用方向键移动在这三项上面，按回车进入选择菜单，选择括号中间的选项，选择这三项一定要从上往下。其中第三项还可以选择 <code>R6800</code> ，原因我就不多说了。
</p>

<p>
选择了上面的内容就可进行下一步了，下面展示一些我的配置。
</p>

<pre class="example" id="org43f9c4d">
Extra packages  ---&gt;
  &lt;*&gt; ipv6helper................... IPv6 Helper and Dynamic Update he.net of ip
LuCI  ---&gt;
  3. Applications  ---&gt;
    &lt;*&gt; luci-app-qos..................... Quality of Service configuration module
    &lt;*&gt; luci-app-flowoffload....................... LuCI support for Flow Offload
    &lt;*&gt; luci-app-ssr-plus.......... SS/SSR/V2Ray/Trojan/Socks5/Tun LuCI interface
    [ ] Include Shadowsocks V2ray Plugin
    [*] Include V2ray
    [ ] Include Trojan
    [ ] Include Redsocks2
    [ ] Include Kcptun
    [ ] Include ShadowsocksR Server
    &lt;*&gt; luci-app-wifischedule...... Turns WiFi on and off according to a schedule
  4. Themes  ---&gt;
    &lt;*&gt; luci-theme-argon............................................. Argon Theme
Utilities  ---&gt;
  Editors  ---&gt;
    &lt;*&gt; vim-fuller........................ Vi IMproved - enhanced vi editor (Big)
</pre>
</div>
</div>

<div id="outline-container-org2fd77a8" class="outline-3">
<h3 id="org2fd77a8">编译</h3>
<div class="outline-text-3" id="text-org2fd77a8">
<p>
<code>make download V=s</code> 先下载要编译的源码
</p>

<p>
<code>make -j1</code> 编译，参数j后面是你的 <code>cpu</code> 的线程加一
</p>

<p>
如果没有正确结束，使用这个命令查错 <code>make -j1 V=99</code>
</p>

<p>
生成的固件在 <code>./bin/targets/ramips/mt7621</code>
</p>
</div>
</div>

<div id="outline-container-orgbfb7569" class="outline-3">
<h3 id="orgbfb7569">刷机</h3>
<div class="outline-text-3" id="text-orgbfb7569">
</div>
<div id="outline-container-org84557bd" class="outline-4">
<h4 id="org84557bd">原生刷LEDE</h4>
<div class="outline-text-4" id="text-org84557bd">
<p>
直接在原生的管理界面点击升级固件，上传带有字段 <code>factory</code> 的固件即可。
</p>
</div>
</div>
<div id="outline-container-org2336c69" class="outline-4">
<h4 id="org2336c69">LEDE升级</h4>
<div class="outline-text-4" id="text-org2336c69">
<p>
在固件升级页面使用带有字段 <code>sysupgrade</code> 的固件。
</p>
</div>
</div>
<div id="outline-container-org69b31b5" class="outline-4">
<h4 id="org69b31b5">救砖或LEDE刷回原生</h4>
<div class="outline-text-4" id="text-org69b31b5">
<p>
使用 <code>nmrpflash -L</code> 列出所有网卡，找到正确的网卡，如果不知道就一个个试。
</p>

<p>
然后使用 <code>nmrpflash -i &lt;网卡名&gt; -f &lt;固件名&gt;</code> 命令，执行命令的瞬间重启路由器，然后就可以看到固件正在上传，等待命令执行完毕后重启路由器就刷机完毕了。
</p>

<p>
建议在 <code>windows</code> 下使用这个工具，这个命令需要管理员权限。
</p>

<p>
注意！！！这个命令只能对网件的路由器使用。
</p>
</div>
</div>
</div>
</div>

</div>
</div>

        <div>
      <div class="post-meta">
        <span title="post date" class="post-info">2020-07-27</span>
        <span title="last modification date" class="post-info">2020-07-27</span>
        <span title="tags" class="post-info"><a href="/tags/openwrt/">OpenWrt</a>, <a href="/tags/lede/">LEDE</a>, <a href="/tags/router/">router</a></span>
        <span title="author" class="post-info">shirui</span>
      </div>
      <section>
        <h1>Comments</h1>
      </section>
      <script src="//code.jquery.com/jquery-latest.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.js"></script>
      <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="/media/js/main.js"></script>
      <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 28.x (<a href="http://orgmode.org">Org mode</a> 9.x)</p>
        <p>
          Copyright &copy; 2012 - <span id="footerYear"></span> <a href="mailto:1229408499 &lt;at&gt; qq &lt;dot&gt; com">shirui</a>
          &nbsp;&nbsp;-&nbsp;&nbsp;
          Powered by <a href="https://github.com/kelvinh/org-page" target="_blank">org-page</a>
          <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
      </div>
    </div>

  </body>
</html>
